<%# _val_foreign_net_tooltip.html.erb - Histogram for last 30 Val Foreign Net values for a ticker %>
<%# Required locals: ticker: Ticker instance, histogram_only: optional %>
<% values = ticker.respond_to?(:recent_trading_days) && ticker.recent_trading_days.present? ? ticker.recent_trading_days.last(30).reverse.map(&:value_foreign_net) : [] %>
<% max_val = values.map(&:abs).max.to_f %>
<% if defined?(histogram_only) && histogram_only %>
  <div class="val-foreign-net-histogram" style="display:flex; align-items:flex-end; height:80px; gap:2px; width:100%; min-width:120px; max-width:220px;">
    <% if values.present? %>
      <% ticker.recent_trading_days.last(30).reverse.each do |day| %>
        <% val = day.value_foreign_net.to_f %>
        <% bar_height = max_val > 0 ? (val.abs / max_val * 70).round : 1 %>
        <% bar_color = val > 0 ? '#4caf50' : (val < 0 ? '#f44336' : '#bbb') %>
        <div title="<%= day.trading_date.strftime('%d-%m') %> <%= number_with_delimiter((val/1000000000.0).round(2)) %>B"
             style="width:6px; height:<%= bar_height %>px; background:<%= bar_color %>; border-radius:2px 2px 0 0; display:inline-block; font-weight:bold;"></div>
      <% end %>
    <% else %>
      <div style="padding:8px 0; text-align:center; color:#888; width:100%;">No data</div>
    <% end %>
  </div>
<% else %>
  <div class="val-foreign-net-tooltip" style="display:none; position:absolute; left:100%; top:0; z-index:20; background:#fff; border:1px solid #ccc; box-shadow:0 2px 8px rgba(0,0,0,0.15); padding:8px; min-width:220px;">
    <% if values.present? %>
      <div style="display:flex; align-items:flex-end; height:80px; gap:2px; margin-top:8px;">
        <% ticker.recent_trading_days.last(30).reverse.each do |day| %>
          <% val = day.value_foreign_net.to_f %>
          <% bar_height = max_val > 0 ? (val.abs / max_val * 70).round : 1 %>
          <% bar_color = val > 0 ? '#4caf50' : (val < 0 ? '#f44336' : '#bbb') %>
          <div title="<%= day.trading_date.strftime('%d-%m') %> <%= number_with_delimiter((val/1000000000.0).round(2)) %>B"
               style="width:6px; height:<%= bar_height %>px; background:<%= bar_color %>; border-radius:2px 2px 0 0; display:inline-block; font-weight:bold;"></div>
        <% end %>
      </div>
    <% else %>
      <div style="padding:8px 0; text-align:center; color:#888;">No data</div>
    <% end %>
  </div>
<% end %>
