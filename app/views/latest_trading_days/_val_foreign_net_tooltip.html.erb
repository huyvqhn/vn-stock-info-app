<%# _val_foreign_net_tooltip.html.erb - Histogram for last 30 Val Foreign Net values for a ticker %>
<%# Required locals: ticker: Ticker instance %>
<div class="val-foreign-net-tooltip" style="display:none; position:absolute; left:100%; top:0; z-index:20; background:#fff; border:1px solid #ccc; box-shadow:0 2px 8px rgba(0,0,0,0.15); padding:8px; min-width:220px;">
  <strong>Last 30 Val Foreign Net</strong>
  <% if ticker.respond_to?(:recent_trading_days) && ticker.recent_trading_days.present? %>
    <% values = ticker.recent_trading_days.last(30).reverse.map(&:value_foreign_net) %>
    <% max_val = values.map(&:abs).max.to_f %>
    <div style="display:flex; align-items:flex-end; height:80px; gap:2px; margin-top:8px;">
      <% ticker.recent_trading_days.last(30).reverse.each do |day| %>
        <% val = day.value_foreign_net.to_f %>
        <% bar_height = max_val > 0 ? (val.abs / max_val * 70).round : 1 %>
        <% bar_color = val > 0 ? '#4caf50' : (val < 0 ? '#f44336' : '#bbb') %>
        <div title="<%= day.trading_date.strftime('%Y-%m-%d') %>: <%= display_billion(val) %>"
             style="width:6px; height:<%= bar_height %>px; background:<%= bar_color %>; border-radius:2px 2px 0 0; display:inline-block;"></div>
      <% end %>
    </div>
    <div style="font-size:0.85em; color:#888; margin-top:4px;">Green: positive, Red: negative, Gray: zero</div>
  <% else %>
    <div style="padding:8px 0; text-align:center; color:#888;">No data</div>
  <% end %>
</div>
